{% extends "base.html" %}
{% block content %}
<style>
  .upload-btn {
  display: inline-block;
  padding: 12px 20px;
  border: 2px dashed #2563eb;
  border-radius: 8px;
  background: #eff6ff;
  color: #1e40af;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s ease;
}

.upload-btn:hover {
  background: #dbeafe;
  border-color: #1d4ed8;
}

.file-name {
  margin-left: 12px;
  font-size: 14px;
  color: #374151;
}

</style>
<div class="card">
  <h2>Upload Syllabus PDF</h2>
  <div
  id="errorBanner"
  style="
    display: none;
    background-color: #fdecea;
    color: #611a15;
    padding: 10px;
    margin-bottom: 12px;
    border-radius: 6px;
    font-weight: 500;
  "
>
  Only PDF files are allowed.
</div>

  <form method="post"
      action="/upload"
      enctype="multipart/form-data"
      onsubmit="return validateAndSubmit()">

    <input type="file" id="file-upload" name="file" hidden>

    <label for="file-upload" class="upload-btn">
      üìÅ Choose Syllabus PDF
    </label>
    
    <span id="file-name" class="file-name">No file chosen</span>
        <br /><br />
    <button type="submit">Generate Review Report</button>
  </form>

  <p style="margin-top:16px; color:#6b7280;">
    PDF will be reviewed and a compliance report will be generated automatically. Please note that it is AI generated and may have inaccuracies.
  </p>
</div>
<script>
  const fileInput = document.getElementById("file-upload");
  const fileNameSpan = document.getElementById("file-name");
  const errorBanner = document.getElementById("errorBanner");
  
  // Update filename display
  fileInput.addEventListener("change", () => {
    if (!fileInput.files.length) {
      fileNameSpan.innerText = "No file chosen";
      return;
    }
  
    const file = fileInput.files[0];
    fileNameSpan.innerText = file.name;
  
    // Instant validation on select
    if (!isPDF(file)) {
      showError("Only PDF files are allowed.");
      fileInput.value = "";
      fileNameSpan.innerText = "No file chosen";
    } else {
      hideError();
    }
  });
  
  function isPDF(file) {
    return (
      file.type === "application/pdf" ||
      file.name.toLowerCase().endsWith(".pdf")
    );
  }
  
  function showError(message) {
    errorBanner.innerText = message;
    errorBanner.style.display = "block";
  }
  
  function hideError() {
    errorBanner.style.display = "none";
  }
  
  function validateAndSubmit() {
    if (!fileInput.files.length) {
      showError("Please select a PDF file.");
      return false;
    }
  
    const file = fileInput.files[0];
  
    if (!isPDF(file)) {
      showError("Only PDF files are allowed.");
      fileInput.value = "";
      fileNameSpan.innerText = "No file chosen";
      return false;
    }
  
    hideError();
  
    // ‚úÖ Only now show loading & allow submit
    showLoading();
    return true;
  }
  </script>
  

{% endblock %}
